{% load static %}
{% load tailwind_tags %}
<!DOCTYPE html>
<html lang="en" x-data="dashboard()">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock %}</title>
    {% tailwind_css %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100 font-sans">
    <div class="flex h-screen overflow-hidden">
        {% block sidebar %} {% endblock %} 
        <div class="flex flex-col flex-1 overflow-hidden"> 
            {% block topnav %} {% endblock %}
            {% block contents %} {% endblock %}
        </div>
    </div>

    <script>
        function dashboard() {
            return {
                mobileMenuOpen: false,
                profileMenuOpen: false,
                chartTimeRange: 'week',
                init() {
                    this.renderCharts();
                    
                    // Watch for changes in chartTimeRange and update chart
                    this.$watch('chartTimeRange', (value) => {
                        this.updateSubmissionChart();
                    });
                },
                renderCharts() {
                    // Submissions Chart
                    const submissionsCtx = document.getElementById('submissionsChart').getContext('2d');
                    this.submissionsChart = new Chart(submissionsCtx, {
                        type: 'line',
                        data: this.getSubmissionData(),
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false,
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });

                    // Categories Chart
                    const categoriesCtx = document.getElementById('categoriesChart').getContext('2d');
                    this.categoriesChart = new Chart(categoriesCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Web', 'Crypto', 'Reverse', 'Forensics', 'Network', 'Misc'],
                            datasets: [{
                                data: [120, 95, 80, 65, 50, 30],
                                backgroundColor: [
                                    'rgba(59, 130, 246, 0.7)',
                                    'rgba(16, 185, 129, 0.7)',
                                    'rgba(139, 92, 246, 0.7)',
                                    'rgba(245, 158, 11, 0.7)',
                                    'rgba(239, 68, 68, 0.7)',
                                    'rgba(156, 163, 175, 0.7)'
                                ],
                                borderColor: [
                                    'rgba(59, 130, 246, 1)',
                                    'rgba(16, 185, 129, 1)',
                                    'rgba(139, 92, 246, 1)',
                                    'rgba(245, 158, 11, 1)',
                                    'rgba(239, 68, 68, 1)',
                                    'rgba(156, 163, 175, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right',
                                }
                            }
                        }
                    });
                },
                getSubmissionData() {
                    if (this.chartTimeRange === 'day') {
                        return {
                            labels: ['00:00', '02:00', '04:00', '06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00', '22:00'],
                            datasets: [
                                {
                                    label: 'Valid Submissions',
                                    data: [5, 8, 12, 15, 20, 35, 45, 50, 42, 38, 30, 18],
                                    borderColor: 'rgba(16, 185, 129, 1)',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    tension: 0.3,
                                    fill: true
                                },
                                {
                                    label: 'Invalid Submissions',
                                    data: [2, 3, 5, 8, 10, 15, 20, 18, 15, 12, 8, 5],
                                    borderColor: 'rgba(239, 68, 68, 1)',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    tension: 0.3,
                                    fill: true
                                }
                            ]
                        };
                    } else if (this.chartTimeRange === 'week') {
                        return {
                            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                            datasets: [
                                {
                                    label: 'Valid Submissions',
                                    data: [120, 145, 180, 210, 240, 320, 280],
                                    borderColor: 'rgba(16, 185, 129, 1)',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    tension: 0.3,
                                    fill: true
                                },
                                {
                                    label: 'Invalid Submissions',
                                    data: [45, 50, 65, 70, 80, 95, 75],
                                    borderColor: 'rgba(239, 68, 68, 1)',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    tension: 0.3,
                                    fill: true
                                }
                            ]
                        };
                    } else { // month
                        return {
                            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                            datasets: [
                                {
                                    label: 'Valid Submissions',
                                    data: [450, 680, 920, 1150],
                                    borderColor: 'rgba(16, 185, 129, 1)',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    tension: 0.3,
                                    fill: true
                                },
                                {
                                    label: 'Invalid Submissions',
                                    data: [180, 220, 250, 300],
                                    borderColor: 'rgba(239, 68, 68, 1)',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    tension: 0.3,
                                    fill: true
                                }
                            ]
                        };
                    }
                },
                updateSubmissionChart() {
                    this.submissionsChart.data = this.getSubmissionData();
                    this.submissionsChart.update();
                }
            }
        }
    </script>
</body>
</html>
